name: Flexible Deployment

on:
  workflow_dispatch:
    inputs:
      deployment_config:
        description: 'Paste JSON config'
        type: string
        required: true
        default: |
          {
            "region": "us-east",
            "environment": "dev",
            "cluster": "aks-dev-001",
            "version": "latest"
          }

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Parse JSON config
        id: config
        run: |
          CONFIG='${{ inputs.deployment_config }}'
          
          REGION=$(echo "$CONFIG" | jq -r '.region')
          ENV=$(echo "$CONFIG" | jq -r '.environment')
          CLUSTER=$(echo "$CONFIG" | jq -r '.cluster')
          VERSION=$(echo "$CONFIG" | jq -r '.version')
          
          echo "region=$REGION" >> $GITHUB_OUTPUT
          echo "environment=$ENV" >> $GITHUB_OUTPUT
          echo "cluster=$CLUSTER" >> $GITHUB_OUTPUT
          echo "version=$VERSION" >> $GITHUB_OUTPUT
      
      - name: Deploy
        run: |
          echo "Deploying:"
          echo "  Region: ${{ steps.config.outputs.region }}"
          echo "  Environment: ${{ steps.config.outputs.environment }}"
          echo "  Cluster: ${{ steps.config.outputs.cluster }}"
          echo "  Version: ${{ steps.config.outputs.version }}"
